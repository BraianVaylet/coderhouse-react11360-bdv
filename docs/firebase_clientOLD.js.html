

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> firebase/clientOLD.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Components</h3><ul><li><a href="Admin.html">Admin</a></li><li><a href="AdminTemplate.html">AdminTemplate</a></li><li><a href="Banner.html">Banner</a></li><li><a href="BannerLinks.html">BannerLinks</a></li><li><a href="BtnInfoAdmin.html">BtnInfoAdmin</a></li><li><a href="BtnInfoAdminList.html">BtnInfoAdminList</a></li><li><a href="ButtonLink.html">ButtonLink</a></li><li><a href="ButtonModalFullImage.html">ButtonModalFullImage</a></li><li><a href="ButtonTooltip.html">ButtonTooltip</a></li><li><a href="ButtonZoom.html">ButtonZoom</a></li><li><a href="Calification.html">Calification</a></li><li><a href="Card.html">Card</a></li><li><a href="Cart.html">Cart</a></li><li><a href="CartCount.html">CartCount</a></li><li><a href="CartItemList.html">CartItemList</a></li><li><a href="CartTemplate.html">CartTemplate</a></li><li><a href="CartWidgetBtn.html">CartWidgetBtn</a></li><li><a href="ChangeLanguageBtn.html">ChangeLanguageBtn</a></li><li><a href="ChangeThemeBtn.html">ChangeThemeBtn</a></li><li><a href="Checkout.html">Checkout</a></li><li><a href="CheckoutTemplate.html">CheckoutTemplate</a></li><li><a href="CustomAvatar.html">CustomAvatar</a></li><li><a href="CustomCollapse.html">CustomCollapse</a></li><li><a href="CustomColorsBox.html">CustomColorsBox</a></li><li><a href="CustomColorsBoxList.html">CustomColorsBoxList</a></li><li><a href="CustomDrawer.html">CustomDrawer</a></li><li><a href="CustomGender.html">CustomGender</a></li><li><a href="CustomInput.html">CustomInput</a></li><li><a href="CustomModal.html">CustomModal</a></li><li><a href="CustomPopover.html">CustomPopover</a></li><li><a href="CustomSelect.html">CustomSelect</a></li><li><a href="CustomSizeBoxList.html">CustomSizeBoxList</a></li><li><a href="CustomStarIcon.html">CustomStarIcon</a></li><li><a href="ExternalLink.html">ExternalLink</a></li><li><a href="FavoritesBtn.html">FavoritesBtn</a></li><li><a href="FavouriteIconBtn.html">FavouriteIconBtn</a></li><li><a href="Favourites.html">Favourites</a></li><li><a href="FavouritesTemplate.html">FavouritesTemplate</a></li><li><a href="Footer.html">Footer</a></li><li><a href="HelmetSEO.html">HelmetSEO</a></li><li><a href="Help.html">Help</a></li><li><a href="HelpBtn.html">HelpBtn</a></li><li><a href="HelpForm.html">HelpForm</a></li><li><a href="Home.html">Home</a></li><li><a href="HorizontalSeparator.html">HorizontalSeparator</a></li><li><a href="IconButtonRotate.html">IconButtonRotate</a></li><li><a href="ImageBox.html">ImageBox</a></li><li><a href="InputEmail.html">InputEmail</a></li><li><a href="InputPassword.html">InputPassword</a></li><li><a href="InputTextArea.html">InputTextArea</a></li><li><a href="InputTextNumber.html">InputTextNumber</a></li><li><a href="Item.html">Item</a></li><li><a href="ItemComplete.html">ItemComplete</a></li><li><a href="ItemCount.html">ItemCount</a></li><li><a href="ItemDetail.html">ItemDetail</a></li><li><a href="ItemDetailAction.html">ItemDetailAction</a></li><li><a href="ItemDetailCharacteristics.html">ItemDetailCharacteristics</a></li><li><a href="ItemDetailDescription.html">ItemDetailDescription</a></li><li><a href="ItemDetailImgBox.html">ItemDetailImgBox</a></li><li><a href="ItemDetailQuestionsAndAnswers.html">ItemDetailQuestionsAndAnswers</a></li><li><a href="ItemDetailTemplate.html">ItemDetailTemplate</a></li><li><a href="ItemNavLink.html">ItemNavLink</a></li><li><a href="ItemNotificationList.html">ItemNotificationList</a></li><li><a href="ItemNotificaton.html">ItemNotificaton</a></li><li><a href="ItemProduct.html">ItemProduct</a></li><li><a href="ItemProductList.html">ItemProductList</a></li><li><a href="ItemPurchases.html">ItemPurchases</a></li><li><a href="Layout.html">Layout</a></li><li><a href="LoginAlert.html">LoginAlert</a></li><li><a href="LoginBtn.html">LoginBtn</a></li><li><a href="LoginFacebook.html">LoginFacebook</a></li><li><a href="LoginGoogle.html">LoginGoogle</a></li><li><a href="LogoOpc1.html">LogoOpc1</a></li><li><a href="LogoOpc2.html">LogoOpc2</a></li><li><a href="Logout.html">Logout</a></li><li><a href="MessageComplete.html">MessageComplete</a></li><li><a href="MessagesList.html">MessagesList</a></li><li><a href="NavBarTemplate.html">NavBarTemplate</a></li><li><a href="NewProductForm.html">NewProductForm</a></li><li><a href="NotFound.html">NotFound</a></li><li><a href="NotFoundTemplate.html">NotFoundTemplate</a></li><li><a href="NotificationList.html">NotificationList</a></li><li><a href="Notifications.html">Notifications</a></li><li><a href="NotificationsBtn.html">NotificationsBtn</a></li><li><a href="NotificationsTemplate.html">NotificationsTemplate</a></li><li><a href="PaymentForm.html">PaymentForm</a></li><li><a href="PaymentMenuTemplate.html">PaymentMenuTemplate</a></li><li><a href="PresentationLinks.html">PresentationLinks</a></li><li><a href="Products.html">Products</a></li><li><a href="ProductsCompleteList.html">ProductsCompleteList</a></li><li><a href="ProductsListTemplate.html">ProductsListTemplate</a></li><li><a href="PurchaseComplete.html">PurchaseComplete</a></li><li><a href="Purchases.html">Purchases</a></li><li><a href="PurchasesList.html">PurchasesList</a></li><li><a href="PurchasesTemplate.html">PurchasesTemplate</a></li><li><a href="Routes.html">Routes</a></li><li><a href="Select.html">Select</a></li><li><a href="SimpleBanner.html">SimpleBanner</a></li><li><a href="SkeletonItem.html">SkeletonItem</a></li><li><a href="SkeletonItemDetailAction.html">SkeletonItemDetailAction</a></li><li><a href="SkeletonItemDetailContent.html">SkeletonItemDetailContent</a></li><li><a href="SkeletonItemDetailImgBox.html">SkeletonItemDetailImgBox</a></li><li><a href="SkItemComplete.html">SkItemComplete</a></li><li><a href="SkItemPurchases.html">SkItemPurchases</a></li><li><a href="StatisticsBox.html">StatisticsBox</a></li><li><a href="SubFooter.html">SubFooter</a></li><li><a href="SubHeader.html">SubHeader</a></li><li><a href="TermsAndCond.html">TermsAndCond</a></li><li><a href="TermsAndCondTemplate.html">TermsAndCondTemplate</a></li><li><a href="TitleAndText.html">TitleAndText</a></li><li><a href="TotalCart.html">TotalCart</a></li><li><a href="WorkWithUsForm.html">WorkWithUsForm</a></li><li><a href="Wrapper.html">Wrapper</a></li><li><a href="WrapperContext.html">WrapperContext</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addMessageHelp">addMessageHelp</a></li><li><a href="global.html#addMessageWorkWithUs">addMessageWorkWithUs</a></li><li><a href="global.html#addProduct">addProduct</a></li><li><a href="global.html#addPurchase">addPurchase</a></li><li><a href="global.html#addStorage">addStorage</a></li><li><a href="global.html#changeIsActiveProductByID">changeIsActiveProductByID</a></li><li><a href="global.html#deleteMessagesByID">deleteMessagesByID</a></li><li><a href="global.html#deleteProductsByID">deleteProductsByID</a></li><li><a href="global.html#editProduct">editProduct</a></li><li><a href="global.html#fetchAllMessages">fetchAllMessages</a></li><li><a href="global.html#fetchAllProducts">fetchAllProducts</a></li><li><a href="global.html#fetchAllPurchases">fetchAllPurchases</a></li><li><a href="global.html#fetchAllPurchasesByUser">fetchAllPurchasesByUser</a></li><li><a href="global.html#fetchProducts">fetchProducts</a></li><li><a href="global.html#fetchProductsByCategory">fetchProductsByCategory</a></li><li><a href="global.html#fetchProductsByID">fetchProductsByID</a></li><li><a href="global.html#fetchStorageByUser">fetchStorageByUser</a></li><li><a href="global.html#handleMapArrayProducts">handleMapArrayProducts</a></li><li><a href="global.html#handleMapArraySelectFormat">handleMapArraySelectFormat</a></li><li><a href="global.html#handleTotalPrice">handleTotalPrice</a></li><li><a href="global.html#loginWithFacebook">loginWithFacebook</a></li><li><a href="global.html#loginWithGoogle">loginWithGoogle</a></li><li><a href="global.html#mapMessagesFromFirebaseToPurchase">mapMessagesFromFirebaseToPurchase</a></li><li><a href="global.html#mapProductFromFirebaseToProduct">mapProductFromFirebaseToProduct</a></li><li><a href="global.html#mapPurchaseFromFirebaseToPurchase">mapPurchaseFromFirebaseToPurchase</a></li><li><a href="global.html#mapStorageFromFirebaseToStorage">mapStorageFromFirebaseToStorage</a></li><li><a href="global.html#mapUserFromFirebaseAuthToUser">mapUserFromFirebaseAuthToUser</a></li><li><a href="global.html#onAuthSignOut">onAuthSignOut</a></li><li><a href="global.html#onAuthStateChanged">onAuthStateChanged</a></li><li><a href="global.html#ROUTES">ROUTES</a></li><li><a href="global.html#setNavigatorLanguage">setNavigatorLanguage</a></li></ul></div><div class="category"><h2>Firebase</h2><h3>Classes</h3><ul><li><a href="FirebaseClient.html">FirebaseClient</a></li></ul><h3>Global</h3><ul><li><a href="global.html#firebaseConfig">firebaseConfig</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>firebase/clientOLD.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import firebase from "firebase"
import "firebase/auth"
import "firebase/firestore"

/**
 * Firebase Client
 * @category  Firebase
 * @see https://firebase.google.com/docs/web/setup?hl=es
 * @author Braian D. Vaylet
 * @description Funciones para mapear, obtener, crear, editar y eliminar registros de la base de datos.
 */
const firebaseConfig = {
  apiKey: "AIzaSyB4BwDPJQiCJEPQkGLNBGVF5hmvsdqEXus",
  authDomain: "aquilastore-5e5b4.firebaseapp.com",
  projectId: "aquilastore-5e5b4",
  storageBucket: "aquilastore-5e5b4.appspot.com",
  messagingSenderId: "541611517575",
  appId: "1:541611517575:web:a4607cc5e3b2969536ba22",
  measurementId: "G-6M9DZJMWYY",
}

try {
  !firebase.apps.length &amp;&amp; firebase.initializeApp(firebaseConfig)
} catch (error) {
  console.error("firebase-error", error)
}

const db = firebase.firestore()

// * MAP FUNC
/**
 * mapUserFromFirebaseAuthToUser
 * @function
 * @param {object} user
 * @returns {object} {avatar: String, username: String, email: String, uid: String}
 * @description [Firebase] Mapea al user que obtengo desde la BD a un nuevo objeto de user
 */
const mapUserFromFirebaseAuthToUser = (user) => {
  const { displayName, email, photoURL, uid } = user
  return {
    avatar: photoURL,
    username: displayName,
    email,
    uid,
  }
}

/**
 * mapProductFromFirebaseToProduct
 * @function
 * @param {object} doc
 * @returns {object} {...data, id: String, createdAt: Date}
 * @description [Firebase] Mapea el elemento Product que obtengo desde la BD a un nuevo objeto Product con el id y la fecha de creación
 */
const mapProductFromFirebaseToProduct = (doc) => {
  const data = doc.data()
  const id = doc.id
  const createdAt =
    data.createdAt || firebase.firestore.Timestamp.fromDate(new Date())
  return { id, ...data, createdAt: +createdAt.toDate() }
}

/**
 * mapPurchaseFromFirebaseToPurchase
 * @function
 * @param {object} doc
 * @returns {object} {...data, id: String, createdAt: Date}
 * @description [Firebase] Mapea el elemento Purchase que obtengo desde la BD a un nuevo objeto Purchase con el id y la fecha de creación
 */
const mapPurchaseFromFirebaseToPurchase = (doc) => {
  const data = doc.data()
  const id = doc.id
  const createdAt =
    data.createdAt || firebase.firestore.Timestamp.fromDate(new Date())
  return { id, ...data, createdAt: +createdAt.toDate() }
}

/**
 * mapStorageFromFirebaseToStorage
 * @function
 * @param {object} doc
 * @returns {object} {...data, id: String, createdAt: Date}
 * @description [Firebase] Mapea el elemento Storage que obtengo desde la BD a un nuevo objeto Storage con el id y la fecha de creación
 */
const mapStorageFromFirebaseToStorage = (doc) => {
  const data = doc.data()
  const id = doc.id
  const createdAt =
    data.createdAt || firebase.firestore.Timestamp.fromDate(new Date())
  return { id, ...data, createdAt: +createdAt.toDate() }
}

/**
 * mapMessagesFromFirebaseToPurchase
 * @function
 * @param {object} doc
 * @returns {object} {...data, id: String, createdAt: Date}
 * @description [Firebase] Mapea el elemento Message que obtengo desde la BD a un nuevo objeto Message con el id y la fecha de creación
 */
const mapMessagesFromFirebaseToPurchase = (doc) => {
  const data = doc.data()
  const id = doc.id
  const createdAt =
    data.createdAt || firebase.firestore.Timestamp.fromDate(new Date())
  return { id, ...data, createdAt: +createdAt.toDate() }
}

// * AUTHENTICATION FUNC
/**
 * onAuthStateChanged
 * @function
 * @param {object} doc
 * @returns {object} mapUserFromFirebaseAuthToUser(user)
 * @description [Firebase] Reviso si el usuario esta autentificado
 */
export const onAuthStateChanged = (onChange) => {
  return firebase.auth().onAuthStateChanged((user) => {
    const normalizedUser = user ? mapUserFromFirebaseAuthToUser(user) : null
    onChange(normalizedUser)
  })
}

/**
 * loginWithGoogle
 * @function
 * @returns {undefined}
 * @description [Firebase] Autentificación con Google
 */
export const loginWithGoogle = () => {
  const googleProvider = new firebase.auth.GoogleAuthProvider()
  return firebase.auth().signInWithPopup(googleProvider)
}

/**
 * loginWithFacebook
 * @function
 * @returns {undefined}
 * @description [Firebase] Autentificación con Facebook
 */
export const loginWithFacebook = () => {
  const facebookProvider = new firebase.auth.FacebookAuthProvider()
  return firebase.auth().signInWithPopup(facebookProvider)
}

/**
 * onAuthSignOut
 * @function
 * @returns {undefined}
 * @description [Firebase] Desautentifico al user
 */
export const onAuthSignOut = () => firebase.auth().signOut()

// * ADD FUNC
/**
 * addProduct
 * @function
 * @param {object} { title: String, description: String, pictureName: String, pictureUrl: String, price: Number, stock: Number, brand: String, model: String, category: [Jackets, Shirts, Shoes, Accesories], calification: Number, gender: [Male, Female, All], sizes: Array(String), colors: Array(String),}
 * @returns {undefined}
 * @description [Firebase] Agrego un nuevo producto a la base de datos
 */
export const addProduct = ({
  title,
  description,
  pictureName,
  pictureUrl,
  price,
  stock,
  brand,
  model,
  category,
  calification,
  gender,
  sizes,
  colors,
}) => {
  return db.collection("products").add({
    title,
    description,
    pictureName,
    pictureUrl,
    price,
    stock,
    brand,
    model,
    category,
    calification,
    gender,
    sizes,
    colors,
    isActive: true,
    createdAt: firebase.firestore.Timestamp.fromDate(new Date()),
  })
}

/**
 * addPurchase
 * @function
 * @param {object} { email:String, fullname:String, dni:String, phone:String, address:String, addressNum :String, addressInfo:String, products: Array(Product), total: Number, itsPaid: Boolean, createdAt = firebase(data), status = "init" }
 * @returns {undefined}
 * @description [Firebase] Agrego un nueva compra a la base de datos
 */
export const addPurchase = ({
  email,
  fullname,
  dni,
  phone,
  address,
  addressNum,
  addressInfo,
  products,
  total,
  itsPaid = false,
  createdAt = firebase.firestore.Timestamp.fromDate(new Date()),
  status = "init",
}) => {
  products.forEach(async (product) => {
    const productDb = await fetchProductsByID(product.id)
    if (productDb.stock > 0 &amp;&amp; productDb.stock >= product.count) {
      // actualizo stock
      await db
        .collection("products")
        .doc(product.id)
        .update({ stock: productDb.stock - product.count })
    } else {
      return new Error("No hay Stock")
    }
  })
  // creo una compra
  return db.collection("purchases").add({
    email,
    fullname,
    dni,
    phone,
    address,
    addressNum,
    addressInfo,
    products,
    total,
    itsPaid,
    createdAt,
    status,
  })
}

/**
 * addStorage
 * @function
 * @param {object} { email:String, favourites: Array(Product), notification: Array(object(Notification)), cart> Array(Product) }
 * @returns {undefined}
 * @description [Firebase] Guardo una copia del LocalStorage del usuario, al momento de hacer un onAuthSignOut se guarda el contenido en la bd y se levanta al momento de volver a autentificarse
 */
export const addStorage = async ({
  email,
  favourites,
  notifications,
  cart,
}) => {
  try {
    const docs = await fetchStorageByUser(email)
    if (docs.length === 0) {
      return db
        .collection("storage")
        .add({ email, favourites, notifications, cart })
    } else if (docs.length === 1) {
      return db
        .collection("storage")
        .doc(docs[0].id)
        .update({ favourites, notifications, cart })
    } else {
      return new Error(
        "hay mas de un registro en storage para este usuario, revisar!"
      )
    }
  } catch (error) {
    console.error("error", error)
  }
}

/**
 * addMessageWorkWithUs
 * @function
 * @param {object} { email:String, name:String, phone:String, linkedin:String }
 * @returns {undefined}
 * @description [Firebase] Guardo un nuevo mensaje en la BD del tipo 'workWithUs'
 */
export const addMessageWorkWithUs = ({ email, name, phone, linkedin }) => {
  return db.collection("messages").add({
    email,
    name,
    phone,
    linkedin,
    viewed: false,
    type: "workWithUs",
    createdAt: firebase.firestore.Timestamp.fromDate(new Date()),
  })
}

/**
 * addMessageHelp
 * @function
 * @param {object} { email:String, name:String, phone:String, comment:String }
 * @returns {undefined}
 * @description [Firebase] Guardo un nuevo mensaje en la BD del tipo 'help'
 */
export const addMessageHelp = ({ email, name, phone, comment }) => {
  return db.collection("messages").add({
    email,
    name,
    phone,
    comment,
    viewed: false,
    type: "help",
    createdAt: firebase.firestore.Timestamp.fromDate(new Date()),
  })
}

// * EDIT FUNC
/**
 * editProduct
 * @function
 * @param {string} id
 * @param {object} { title: String, description: String, pictureName: String, pictureUrl: String, price: Number, stock: Number, brand: String, model: String, category: [Jackets, Shirts, Shoes, Accesories], calification: Number, gender: [Male, Female, All], sizes: Array(String), colors: Array(String),}
 * @returns {undefined}
 * @description [Firebase] Edito un producto por id
 */
export const editProduct = (
  id,
  {
    title,
    description,
    pictureName,
    pictureUrl,
    price,
    stock,
    brand,
    model,
    category,
    calification,
    gender,
    sizes,
    colors,
  }
) => {
  return db
    .collection("products")
    .doc(id)
    .update({
      title,
      description,
      pictureName,
      pictureUrl,
      price,
      stock,
      brand,
      model,
      category,
      calification,
      gender,
      sizes,
      colors,
      isActive: true,
      createdAt: firebase.firestore.Timestamp.fromDate(new Date()),
    })
}

/**
 * changeIsActiveProductByID
 * @function
 * @param {string} id
 * @param {boolean} active
 * @returns {undefined}
 * @description [Firebase] Edito el estado isActive de un producto
 */
export const changeIsActiveProductByID = async (id, active) => {
  try {
    return await db.collection("products").doc(id).update({ isActive: active })
  } catch (error) {
    console.error("error", error)
  }
}

// * GET FUNC
/**
 * fetchAllProducts
 * @function
 * @returns {array} Products
 * @description [Firebase] Obtengo todos los productos de la base de datos
 */
export const fetchAllProducts = async () => {
  try {
    const doc = await db.collection("products").get()
    return doc.docs.map(mapProductFromFirebaseToProduct)
  } catch (error) {
    console.error("error", error)
  }
}

/**
 * fetchProducts
 * @function
 * @returns {array} Products
 * @description [Firebase] Obtengo todos los productos de la base de datos si isActive === true
 */
export const fetchProducts = async () => {
  try {
    const doc = await db
      .collection("products")
      .where("isActive", "==", true)
      .get()
    return doc.docs.map(mapProductFromFirebaseToProduct)
  } catch (error) {
    console.error("error", error)
  }
}

/**
 * fetchProductsByCategory
 * @function
 * @param {string} category
 * @returns {array} Products
 * @description [Firebase] Obtengo todos los productos de la base de datos filtrados por categoria donde isActive === true
 */
export const fetchProductsByCategory = async (category) => {
  try {
    const doc = await db
      .collection("products")
      .where("category", "==", category)
      .where("isActive", "==", true)
      .get()
    return doc.docs.map(mapProductFromFirebaseToProduct)
  } catch (error) {
    console.error("error", error)
  }
}

/**
 * fetchProductsByID
 * @function
 * @param {string} id
 * @returns {object} Product
 * @description [Firebase] Obtengo un producto de la base de datos por id
 */
export const fetchProductsByID = async (id) => {
  try {
    const doc = await db.collection("products").doc(id).get()
    if (doc.exists) {
      return mapProductFromFirebaseToProduct(doc)
    } else {
      console.error("error", "Error, el producto no existe")
      return {}
    }
  } catch (error) {
    console.error("error", error)
  }
}

/**
 * fetchAllPurchases
 * @function
 * @returns {array} Purchases
 * @description [Firebase] Obtengo todas las compras de la base de datos
 */
export const fetchAllPurchases = async () => {
  try {
    const doc = await db
      .collection("purchases")
      .orderBy("createdAt", "asc")
      .get()
    return doc.docs.map(mapPurchaseFromFirebaseToPurchase)
  } catch (error) {
    console.error("error", error)
  }
}

/**
 * fetchAllPurchasesByUser
 * @function
 * @param {string} email
 * @returns {array} Purchases
 * @description [Firebase] Obtengo todas las compras de la base de datos filtradas por el email de un user
 */
export const fetchAllPurchasesByUser = async (email) => {
  try {
    const doc = await db
      .collection("purchases")
      .where("email", "==", email)
      .get()
    return doc.docs.map(mapPurchaseFromFirebaseToPurchase)
  } catch (error) {
    console.error("error", error)
  }
}

/**
 * fetchStorageByUser
 * @function
 * @param {string} email
 * @returns {object} Storage {favourites, notifications, cart}
 * @description [Firebase] Obtengo la copia del storage almacenada en la bd por email del user
 */
export const fetchStorageByUser = async (email) => {
  try {
    const doc = await db.collection("storage").where("email", "==", email).get()
    return doc.docs.map(mapStorageFromFirebaseToStorage)
  } catch (error) {
    console.error("error", error)
  }
}

/**
 * fetchAllMessages
 * @function
 * @returns {array} Messages
 * @description [Firebase] Obtengo todos los mensajes de la base de datos
 */
export const fetchAllMessages = async () => {
  try {
    const doc = await db
      .collection("messages")
      .orderBy("createdAt", "asc")
      .get()
    return doc.docs.map(mapMessagesFromFirebaseToPurchase)
  } catch (error) {
    console.error("error", error)
  }
}

// * DELETE FUNC
/**
 * deleteProductsByID
 * @function
 * @param {string} id
 * @returns {undefined}
 * @description [Firebase] Elimino un producto de la bd por id
 */
export const deleteProductsByID = async (id) => {
  try {
    return await db.collection("products").doc(id).delete()
  } catch (error) {
    console.error("error", error)
  }
}

/**
 * deleteMessagesByID
 * @function
 * @param {string} id
 * @returns {undefined}
 * @description [Firebase] Elimino un mensaje de la bd por id
 */
export const deleteMessagesByID = async (id) => {
  try {
    return await db.collection("messages").doc(id).delete()
  } catch (error) {
    console.error("error", error)
  }
}
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

</body>
</html>
